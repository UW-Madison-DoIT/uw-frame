# uPortal-app-framework release engineering

## Release authorization

This project has [adopted Apache rules][] with necessary or pragmatic local adaptations.

One local adaptation is that although Apache would call for
[a suitable vote][Apache Release Policy re Release Approval] of
[the uPortal-app-framework Committers][] on [uportal-dev@][]
to authorize specific releases,
in this project the committers have delegated discretionary release
authority to release engineers. We cut a lot of releases; we don't vote first.

## Select a version

### Labeling pull requests

Look at [closed pull requests][uportal-app-framework closed pull requests]
since the last release. There should be labels on pull requests communicating
what kind of release it's appropriate to include them in: major, minor, or patch
(x.y.z respectively). (See [Semantic Versioning][].)

### Determining the release version from those labels

The next release should be the least-significant kind of release appropriate to
include all the changes. For example, if it's all patch-appropriate change,
you're cutting a patch release, but if there's even just one breaking change,
it's a major release.

You'll use this version number in a few places.

### Milestone in GitHub

+ [Create a milestone][uportal-app-framework milestones]
  named for the version you're cutting, if it does not yet exist.
+ If using an existing milestone, ensure nothing is currently erroneously marked
  with that milestone, e.g. open pull requests or issues that someone hoped
  might be resolved for this version but alas were not. You can examine this by
  simply [clicking the milestone's name][uportal-app-framework milestones]
  to view the milestone.
+ Mark the
  [pull requests that merged to `master`][uportal-app-framework closed pull requests]
  since the previous release with that milestone.
+ [Close the milestone][uportal-app-framework milestones].

Tada! The pull requests in this release now say the version they released in
right on them. And there's a handy milestone that rolls up all the pull requests
in this version.

## Release steps

### Finalize documentation

Before cutting the release, do what you can to square away the documentation for the release. Add the pull requests from the milestone to the [CHANGELOG][].

### Java release

Now do release for Java.

Use the Maven command line client to prepare, build, sign, and publish to the
Sonatype-hosted central open source software artifact repository.

```sh
mvn release:prepare
mvn release:perform
```

_Iff it went well_, push the 2 new git commits to
uPortal-project/uPortal-app-framework:master . Both of these commits were
generated by the mvn release commands. The first is the commit that set the
version numbers to the version you released; the second is the commit that set
the version numbers to the new snapshot.

Assuming that your `origin` is uPortal-project/uPortal-app-framework, you can
push those commits using

```sh
git push origin master
git push origin uportal-app-framework-maven-<version>
```

If you call canonical something else (like, say, `upstream`), you'll need to
adjust the git push commands accordingly.

Then,

+ [Release Maven artifacts][] from
  [central staging repository][central Maven staging repository]

### Updating JIRA issues

UW-Madison uses a private JIRA instance tracking work on this project.
In practice committers serving as release engineers on uportal-app-framework are
UW-Madison staff with access to this private JIRA.

In the [`MUMUP` JIRA project][], find the last unreleased patch version. If the
current release is a major or minor update, rename the version accordingly.
Apply that version as a `Fix Version` to the JIRA tickets resolved since the
last release. When all tickets have been added, `Release` the version and
create the next patch version.

[Semantic Versioning]: http://semver.org/
[uportal-app-framework closed pull requests]: https://github.com/uPortal-Project/uportal-app-framework/pulls?q=is%3Apr+is%3Aclosed
[uportal-app-framework milestones]: https://github.com/uPortal-Project/uportal-app-framework/milestones
[CHANGELOG]: ../CHANGELOG.md
[Release Maven artifacts]: https://central.sonatype.org/pages/releasing-the-deployment.html
[central Maven staging repository]: https://oss.sonatype.org/#stagingRepositories
[adopted Apache rules]: https://github.com/uPortal-Project/uportal-app-framework/blob/master/committers.md#rules
[Apache Release Policy re Release Approval]: http://www.apache.org/legal/release-policy.html#release-approval
[the uPortal-app-framework Committers]: https://github.com/uPortal-Project/uportal-app-framework/blob/master/committers.md#who-are-the-committers
[uportal-dev@]: https://groups.google.com/a/apereo.org/forum/#!forum/uportal-dev
[`MUMUP` JIRA project]: https://jira.doit.wisc.edu/jira/projects/MUMUP?selectedItem=com.atlassian.jira.jira-projects-plugin%3Arelease-page&status=unreleased
